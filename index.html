<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DM Generator</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" href="dist/style.css">
</head>
<body>
    <div class="page-container">
        <div class="sidebar">
            <div class="sidebar__actions">
                <div class="sidebar__action-group">
                    <h2 class="sidebar__label">Individual Treasure</h2>
                    <a id="ind--1" class="link--white sidebar__action" href="#">CR 0-4</a>
                    <a id="ind--2" class="link--white sidebar__action" href="#">CR 5-10</a>
                    <a id="ind--3" class="link--white sidebar__action" href="#">CR 11-16</a>
                    <a id="ind--4" class="link--white sidebar__action" href="#">CR 17+</a>
                </div>
                <div class="sidebar__action-group">
                    <h2 class="sidebar__label">Treasure Hoard</h2>
                    <a id="hoard--1" class="link--white sidebar__action" href="#">CR 0-4</a>
                    <a id="hoard--2" class="link--white sidebar__action" href="#">CR 5-10</a>
                    <a id="hoard--3" class="link--white sidebar__action" href="#">CR 11-16</a>
                    <a id="hoard--4" class="link--white sidebar__action" href="#">CR 17+</a>
                </div>
            </div>
        </div>
        <div class="dashboard">
            <h1>DM Generator</h1>
            <p>Desktop application for generating random numbers and rolling on Dungeon Master tables.</p>
        </div>
    </div>
</body>
</html>

<script>
    const fs = require('fs');

    // Add click events to all sidebar actions
    var actions = document.querySelectorAll(".sidebar__action");
    for (var i = 0; i < actions.length; i++) {
        actions[i].addEventListener('click', function(event) { rollTable(event.target.id) }, false);
    }

    // Roll on table
    function rollTable(tableID) {
        // Open and read relevant json file within tables/ directory
        var rawdata = fs.readFileSync("tables/" + tableID + ".json");
        var table = JSON.parse(rawdata);

        // Make an array of all of the loot keys
        var keys = [];
        for (var i in table.loot) {
            keys.push(i);
        }

        // Generates random number between 1 and 100
        var randNum = Math.floor(Math.random() * 100) + 1; 

        // For each key, see if 1d100 lies within it
        var tableKey;
        for (var i in keys) {
            if (inRange(randNum, keys[i])) {
                tableKey = keys[i];
                break;
            }
        }
        console.log(table.loot[tableKey]);
    }

    // Check to see which bracket the randomly generated number falls within
    function inRange(num, range) {
        if (range.includes("+")) {
            return num >= range.split("+")[0];
        } else {
            var min = range.split("-")[0];
            var max = range.split("-")[1];
            return num >= min && num <= max;
        }
    }

    // Calculate dice action
    function diceRoll(action) {

    }
</script>